--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\Box\Box Sync\Snuffles Backup\gh8728\Projects\Liquor\supply_side\module\cf_analysis.txt
  log type:  text
 opened on:  16 Mar 2018, 11:38:47

. 
. use cf_sum

. 
. /* Doing some data clean up. Looks like the estimation didn't work on these
> products as the algorithm didn't move from initial guess */
. gen no_steps = (Q_mode == .)

. foreach var of varlist c_* b_* zeta_* base_* base_avg_p base_wavg_p lin_avg_p {
  2.         replace `var' = . if no_steps
  3. }
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(13 real changes made, 13 to missing)
(0 real changes made)
(0 real changes made)
(13 real changes made, 13 to missing)

. 
. // calculating number of steps in price schedule
. egen total_options = rownonmiss(actual_p*) if _merge_ps == 3 & !no_steps
(8580 missing values generated)

. 
. gen month = month(dofm(date_m))

. 
. /* 
> CORRECTION
> removing impact of complexity  cost here. Already subtracted off in CF,
> but easier to handle it here */
. replace lin_w_profit = lin_w_profit + 2*zeta_mid
(1161 real changes made, 13 to missing)

. replace base_w_profit = base_w_profit + total_options*zeta_mid
(1148 real changes made)

. 
. gen delta_w_profit = lin_w_profit - base_w_profit
(8580 missing values generated)

. gen delta_r_profit = lin_r_profit - base_r_profit
(8580 missing values generated)

. gen delta_cs = lin_cs - base_cs
(8580 missing values generated)

. 
. gen pct_delta_w_profit = (lin_w_profit - base_w_profit)/base_w_profit
(8580 missing values generated)

. gen pct_delta_r_profit = (lin_r_profit - base_r_profit)/base_r_profit
(8580 missing values generated)

. gen pct_delta_cs = (lin_cs - base_cs)/base_cs
(8580 missing values generated)

. gen pct_total_change = (lin_w_profit + lin_r_profit + lin_cs - base_w_profit - base_r_profit - base_cs ) / (
> base_w_profit + base_r_profit + base_cs)
(8580 missing values generated)

. 
. gen inv_b = 1/b_mode
(8580 missing values generated)

. 
. gen total_change = delta_w_profit + delta_r_profit + delta_cs
(8580 missing values generated)

. gen pos_change = (total_change > 0) if total_change != .
(8580 missing values generated)

. gen q_weight = exp(-Q_mode)
(8580 missing values generated)

. gen p_diff = base_wavg_p - lin_avg_p
(8580 missing values generated)

. gen big_change = (abs(total_change) > 10000) if total_change != .
(8580 missing values generated)

. gen good = (_merge_ps == 3) & !big_change & !pos_change

. 
. tab total_options

total_optio |
         ns |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |         86        7.49        7.49
          3 |        201       17.51       25.00
          4 |        260       22.65       47.65
          5 |        339       29.53       77.18
          6 |        189       16.46       93.64
          7 |         62        5.40       99.04
          8 |         11        0.96      100.00
------------+-----------------------------------
      Total |      1,148      100.00

. tab pos_change

 pos_change |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,071       93.29       93.29
          1 |         77        6.71      100.00
------------+-----------------------------------
      Total |      1,148      100.00

. 
. // descriptive stats for estimted parameters
. 
. tabstat c_mode b_mode inv_b zeta_mid if good, statistics(mean sd p25 p50 p75) columns(statistics)

    variable |      mean        sd       p25       p50       p75
-------------+--------------------------------------------------
      c_mode |   14.6068   9.11911  7.708355  12.83846  18.70443
      b_mode |  35.20403  8.589921  31.61673  39.98027  39.99451
       inv_b |  .0331194  .0250499  .0250034  .0250123  .0316289
    zeta_mid |  7.956786  45.58187  .4611326  .9898828  3.028252
----------------------------------------------------------------

. tabstat delta_w_profit delta_r_profit delta_cs total_change if good, statistics(mean sd p5 p25 p50 p75 p95) 
> columns(statistics)

    variable |      mean        sd        p5       p25       p50       p75       p95
-------------+----------------------------------------------------------------------
delta_w_pr~t | -105.3279  150.1037 -385.1743 -123.7333 -52.10307 -24.02505  -2.02413
delta_r_pr~t |  75.43724  112.1555  1.880447  16.69414   37.3292  88.03889   267.603
    delta_cs | -112.8576  163.5125 -406.4603 -132.3362 -56.47166 -25.42377  -2.78595
total_change | -142.7482  200.7085 -525.7377 -167.5657 -71.92434 -33.26801 -3.111246
------------------------------------------------------------------------------------

. tabstat pct_delta_w_profit pct_delta_r_profit pct_delta_cs pct_total_change if good, statistics(mean sd p5 p
> 25 p50 p75 p95) columns(statistics)

    variable |      mean        sd        p5       p25       p50       p75       p95
-------------+----------------------------------------------------------------------
pct~w_profit | -.2537172  .0344264 -.2756611 -.2653016 -.2623171 -.2555508 -.1135225
pct~r_profit |  .3141782  .0171445  .2808192  .3071667  .3208337  .3251234  .3286135
pct_delta_cs | -.2652065  .0099391 -.2821297  -.267048 -.2645624 -.2637582 -.2359628
pct_total_~e | -.1338237  .0169439 -.1537448   -.13795 -.1360373 -.1338751 -.0677505
------------------------------------------------------------------------------------

. 
. 
. kdensity c_mode, title("") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export c_density.pdf, replace
(file c_density.pdf written in PDF format)

. 
. kdensity b_mode, bwidth(2) title("") ///
>         xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export b_density.pdf, replace
(file b_density.pdf written in PDF format)

. 
. kdensity inv_b, bwidth(.01) title("") ///
>         xtitle("b in Beta(1,1/b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export b_density_inv.pdf, replace 
(file b_density_inv.pdf written in PDF format)

. 
. kdensity b_mode if b_mode < 39, bwidth(2)title("") ///
>         xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export b_mode_less.pdf, replace 
(file b_mode_less.pdf written in PDF format)

. 
. kdensity zeta_mid if zeta_mid <= 50, bwidth(1.0) ///
>         title("") ///
>         xtitle("Cost of Additional Option (Midpoint)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export zeta_density.pdf, replace
(file zeta_density.pdf written in PDF format)

. 
. twoway (scatter lin_avg_p base_wavg_p if pos_change) ///
>         (scatter lin_avg_p base_wavg_p if !pos_change) ///
>         (function y=x, range(10 60)), ///
>         xtitle("With Quantity Discounts") ///
>         ytitle("Without Quantity Discounts") ///
>         title("Average Retailer Price") ///
>         legend(order(1 2) ///
>                 label(1 "Positive Total Change") ///
>                 label(2 "Negative Total Change"))

. graph export r_price_comp.pdf, replace
(file r_price_comp.pdf written in PDF format)

. 
. twoway (scatter lin_avg_p base_wavg_p if good) ///
>         (function y=x, range(10 60)), ///
>         xtitle("Average Retailer Price With Quantity Discounts") ///
>         ytitle("Average Retailer PriceWithout Quantity Discounts") ///
>         title("") ///
>         legend(off) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export r_price_comp_good.pdf, replace
(file r_price_comp_good.pdf written in PDF format)

. 
. tabstat c_mode b_mode zeta_mid, statistics(mean sd p25 p50 p75) columns(statistics) by(pos_change)

Summary for variables: c_mode b_mode zeta_mid
     by categories of: pos_change 

pos_change |      mean        sd       p25       p50       p75
-----------+--------------------------------------------------
         0 |  14.57144  9.079118  7.888519  12.72039  18.65922
           |  35.12162  8.587683  31.42278  39.97983  39.99437
           |  17.64724   115.504  .4647064  1.003318  3.182311
-----------+--------------------------------------------------
         1 |  .0429862  .0824279  .0009811  .0046846  .0318616
           |  33.91937  9.925925  32.07115  39.92583   39.9628
           |  173.9328  302.8524  4.610489  7.752578  162.2777
-----------+--------------------------------------------------
     Total |  13.59697  9.492976  6.942173  11.67576  18.01805
           |  35.04098  8.684248  31.48447  39.97704  39.99398
           |  28.12981  141.6072  .4963359  1.110598  3.923025
--------------------------------------------------------------

. tabstat c_mode inv_b zeta_mid, statistics(mean sd p25 p50 p75) columns(statistics) by(pos_change)

Summary for variables: c_mode inv_b zeta_mid
     by categories of: pos_change 

pos_change |      mean        sd       p25       p50       p75
-----------+--------------------------------------------------
         0 |  14.57144  9.079118  7.888519  12.72039  18.65922
           |  .0331603  .0249265  .0250035  .0250126  .0318241
           |  17.64724   115.504  .4647064  1.003318  3.182311
-----------+--------------------------------------------------
         1 |  .0429862  .0824279  .0009811  .0046846  .0318616
           |  .0345744  .0179173  .0250233  .0250464  .0311807
           |  173.9328  302.8524  4.610489  7.752578  162.2777
-----------+--------------------------------------------------
     Total |  13.59697  9.492976  6.942173  11.67576  18.01805
           |  .0332552  .0245156  .0250038  .0250144  .0317617
           |  28.12981  141.6072  .4963359  1.110598  3.923025
--------------------------------------------------------------

. 
. graph box total_change if good, over(total_options) noout ///
>         ytitle("Total Welfare Change (Monthly $)") ///
>         title("Total Welfare Change by Number of Options") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export change_by_parts.pdf,replace
(file change_by_parts.pdf written in PDF format)

. 
. twoway (scatter total_change c_mode) ///
>         (lowess total_change c_mode, bwidth(.5) lwidth(thick)) if good, ///
>         ytitle("Total Welfare Change") xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export welf_vs_c.pdf, replace
(file welf_vs_c.pdf written in PDF format)

. 
. twoway (lowess total_change c_mode, bwidth(.5) lwidth(thick)) if good, ///
> ytitle("Total Welfare Change") xtitle("Wholesaler Marginal Cost") yline(0) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export welf_vs_c_no_scatter.pdf, replace
(file welf_vs_c_no_scatter.pdf written in PDF format)

. 
. twoway (scatter total_change b_mode) ///
>         (lowess total_change b_mode, bwidth(.5) lwidth(thick)) if good, ///
>         ytitle("Total Welfare Change") xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export welf_vs_b.pdf, replace
(file welf_vs_b.pdf written in PDF format)

. 
. twoway (lowess total_change b_mode, bwidth(.5) lwidth(thick)) if good, ///
> ytitle("Total Welfare Change") xtitle("b in Beta(1,b)") yline(0) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export welf_vs_b_no_scatter.pdf, replace
(file welf_vs_b_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_w_profit b_mode) if good, ///
>         ytitle("Change in Wholesaler Profits") ///
>         xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_profit_vs_b_no_scatter.pdf, replace
(file w_profit_vs_b_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_w_profit b_mode) if good, ///
>         ytitle("Change in Wholesaler Profits") ///
>         xtitle("b in Beta(1,b)") xscale(reverse) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_profit_vs_b_no_scatter_rev.pdf, replace
(file w_profit_vs_b_no_scatter_rev.pdf written in PDF format)

. 
. twoway (lowess delta_w_profit inv_b) if good, ///
>         ytitle("Change in Wholesaler Profits") ///
>         xtitle("b in Beta(1,1/b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_profit_vs_b_no_scatter_inv.pdf, replace
(file w_profit_vs_b_no_scatter_inv.pdf written in PDF format)

. 
. twoway (lowess delta_r_profit b_mode) if good, ///
>         ytitle("Change in Average Retailer Profits") ///
>         xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export r_profit_vs_b_no_scatter.pdf, replace
(file r_profit_vs_b_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_w_profit c_mode) if good, ///
>         ytitle("Change in Wholesaler Profits") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_profit_vs_c_no_scatter.pdf, replace
(file w_profit_vs_c_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_r_profit c_mode) if good, ///
>         ytitle("Change in Average Retailer Profits") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export r_profit_vs_c_no_scatter.pdf, replace
(file r_profit_vs_c_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_cs b_mode) if good, ///
>         ytitle("Change in Consumer Surplus") ///
>         xtitle("b in Beta(1,b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_vs_b_no_scatter.pdf, replace
(file cs_vs_b_no_scatter.pdf written in PDF format)

. 
. twoway (lowess delta_cs b_mode) if good, ///
>         ytitle("Change in Consumer Surplus") ///
>         xtitle("b in Beta(1,b)") xscale(reverse) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_vs_b_no_scatter_rev.pdf, replace
(file cs_vs_b_no_scatter_rev.pdf written in PDF format)

. 
. twoway (lowess delta_cs inv_b) if good, ///
>         ytitle("Change in Consumer Surplus") ///
>         xtitle("b in Beta(1,1/b)") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_vs_b_no_scatter_inv.pdf, replace
(file cs_vs_b_no_scatter_inv.pdf written in PDF format)

. 
. twoway (lowess delta_cs c_mode) if good, ///
>         ytitle("Change in Consumer Surplus") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_vs_c_no_scatter.pdf, replace
(file cs_vs_c_no_scatter.pdf written in PDF format)

. 
. graph box delta_w_profit if good, over(total_options) noout ///
>         ytitle("Change in Wholesaler Profits") b1title("Number of Price Segments") ///
>         note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_change_by_parts.pdf,replace
(file w_change_by_parts.pdf written in PDF format)

. 
. graph box delta_r_profit if good, over(total_options) noout ///
>         ytitle("Change in Average Retailer Profits") ///
>         title("Change in Average Retailer Profits by Number of Options") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export r_change_by_parts.pdf,replace
(file r_change_by_parts.pdf written in PDF format)

. 
. graph box delta_cs if good, over(total_options) noout ///
>         ytitle("Change in Consumer Surplus") ///
>         b1title("Number of Price Segments") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_change_by_parts.pdf,replace
(file cs_change_by_parts.pdf written in PDF format)

. 
. /* percent changes */
. 
. graph box pct_delta_w_profit if good, over(total_options) noout ///
>         ytitle("Percent Change in Wholesaler Profits") ///
>         title("Percent Wholesaler Profit Change by Number of Options") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_pct_change_by_parts.pdf,replace
(file w_pct_change_by_parts.pdf written in PDF format)

. 
. twoway (lowess pct_delta_w_profit c_mode) if good, ///
>         ytitle("Percent Change in Wholesaler Profits") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_pct_profit_vs_c_no_scatter.pdf, replace
(file w_pct_profit_vs_c_no_scatter.pdf written in PDF format)

. 
. twoway (lowess pct_delta_w_profit b_mode) if good, ///
>         ytitle("Percent Change in Wholesaler Profits") ///
>         xtitle("Retailer Heterogeneity") xscale(reverse) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export w_pct_profit_vs_b_no_scatter_rev.pdf, replace
(file w_pct_profit_vs_b_no_scatter_rev.pdf written in PDF format)

. 
. twoway (lowess pct_delta_cs b_mode) if good, ///
>         ytitle("Percent Change in Consumer Surplus") ///
>         xtitle("Retailer Heterogeneity") xscale(reverse) note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_pct_vs_b_no_scatter_rev.pdf, replace
(file cs_pct_vs_b_no_scatter_rev.pdf written in PDF format)

. 
. twoway (lowess pct_delta_cs c_mode) if good, ///
>         ytitle("Percent Change in Consumer Surplus") ///
>         xtitle("Wholesaler Marginal Cost") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_pct_vs_c_no_scatter.pdf, replace
(file cs_pct_vs_c_no_scatter.pdf written in PDF format)

. 
. graph box pct_delta_cs if good, over(total_options) noout ///
>         ytitle("Percent Change in Consumer Surplus") ///
>         title("Percent Change in Consumer Surplus by Number of Options") note("") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export cs_pct_change_by_parts.pdf,replace
(file cs_pct_change_by_parts.pdf written in PDF format)

. 
. /* FOREGONE PROFIT CALCS */
. 
. gen foregone_prof_pct = zeta_lb / (base_w_profit)*100 // want (prof(N+1) - prof(N))/prof(N). This is that.
(8580 missing values generated)

. 
. tabstat zeta_lb if good, stat(count mean sd p25 p50 p75) by(total_options) col(stats)

Summary for variables: zeta_lb
     by categories of: total_options 

total_options |         N      mean        sd       p25       p50       p75
--------------+------------------------------------------------------------
            2 |        56  29.66845  51.66978  1.767176  13.96192  22.74407
            3 |       163  4.147706  5.690073  .9258563  1.937979  6.162646
            4 |       246  1.688848  2.338973  .3057801  .7321011  1.948182
            5 |       333  1.128945  1.740765  .3108847  .5176014  1.075113
            6 |       189  .6960432  .8562756  .2429943  .5007513  .8397643
            7 |        62  .3876935  .3708127  .1296565  .2362952  .4849632
            8 |        11  .5585895  .3201602   .225663  .6815055  .8187968
--------------+------------------------------------------------------------
        Total |      1060  3.104376  13.66285  .3087986  .6525967  1.732428
---------------------------------------------------------------------------

. tabstat foregone_prof_pct if good, stat(count mean sd p25 p50 p75) by(total_options) col(stats)

Summary for variables: foregone_prof_pct
     by categories of: total_options 

total_options |         N      mean        sd       p25       p50       p75
--------------+------------------------------------------------------------
            2 |        56  4.707492  .1510327  4.761631  4.763378  4.767511
            3 |       163  1.343275  .0711173  1.327169  1.371372  1.396596
            4 |       246  .5234079  .0522893  .4803928   .483114  .5841938
            5 |       333  .2474839  .0140868  .2436504  .2437504   .243952
            6 |       189  .1406541  .0057804  .1396443  .1397338  .1398206
            7 |        62  .0892153  .0001928  .0891362  .0892317  .0893136
            8 |        11  .0618352  .0003202  .0614638  .0619249   .062082
--------------+------------------------------------------------------------
        Total |      1060  .6854142  1.033893  .2423311  .2440178   .596485
---------------------------------------------------------------------------

. 
. graph box zeta_lb if good, over(total_options) noout ///
>         ytitle("Foregone Profits") ///
>         title("Foregone Profits by Not Offering Additional Segment") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export foregone_prof_by_parts.pdf, replace
(file foregone_prof_by_parts.pdf written in PDF format)

. 
. graph box foregone_prof_pct if good, over(total_options) ///
>         ytitle("Percent of Current Profits") ///
>         title("Foregone Profits by Not Offering Additional Segment") ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export foregone_prof_by_parts_pct.pdf, replace
(file foregone_prof_by_parts_pct.pdf written in PDF format)

. 
. reg zeta_lb proof d_g_gin-d_g_teq d_s_750-d_s_175L i.month i.total_options if good, vce(robust) cformat(%9.3
> f) pformat(%5.3f)

Linear regression                                      Number of obs =    1060
                                                       F( 28,  1031) =    4.68
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.2586
                                                       Root MSE      =  11.923

-------------------------------------------------------------------------------
              |               Robust
      zeta_lb |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
        proof |     -0.011      0.020    -0.56   0.576       -0.051       0.028
      d_g_gin |     -2.141      0.958    -2.24   0.026       -4.020      -0.262
      d_g_vod |     -0.906      0.679    -1.34   0.182       -2.238       0.425
      d_g_rum |     -4.429      1.537    -2.88   0.004       -7.445      -1.413
      d_g_sch |     -1.442      0.847    -1.70   0.089       -3.104       0.219
      d_g_brb |      3.920      1.936     2.02   0.043        0.121       7.720
      d_g_whs |     -1.743      0.696    -2.50   0.012       -3.108      -0.377
      d_g_teq |      1.081      1.293     0.84   0.403       -1.456       3.618
    d_s_750ML |      2.859      2.337     1.22   0.221       -1.726       7.445
       d_s_1L |      2.460      2.419     1.02   0.309       -2.286       7.206
     d_s_175L |      5.220      2.204     2.37   0.018        0.896       9.543
              |
        month |
           2  |      1.070      3.453     0.31   0.757       -5.705       7.846
           3  |     -0.307      2.034    -0.15   0.880       -4.298       3.683
           4  |     -2.751      2.395    -1.15   0.251       -7.451       1.948
           5  |     -0.595      2.484    -0.24   0.811       -5.469       4.279
           6  |      0.349      2.681     0.13   0.896       -4.911       5.610
           7  |     -1.811      2.467    -0.73   0.463       -6.652       3.030
           8  |     -1.086      2.420    -0.45   0.654       -5.835       3.664
           9  |     -0.967      2.082    -0.46   0.643       -5.052       3.118
          10  |     -1.031      2.153    -0.48   0.632       -5.257       3.194
          11  |     -0.517      2.041    -0.25   0.800       -4.522       3.489
          12  |     -1.585      2.136    -0.74   0.458       -5.776       2.607
              |
total_options |
           3  |    -27.249      7.268    -3.75   0.000      -41.511     -12.987
           4  |    -29.510      7.089    -4.16   0.000      -43.420     -15.601
           5  |    -30.339      7.138    -4.25   0.000      -44.345     -16.332
           6  |    -30.650      7.115    -4.31   0.000      -44.612     -16.688
           7  |    -29.243      6.636    -4.41   0.000      -42.264     -16.222
           8  |    -30.926      7.147    -4.33   0.000      -44.950     -16.903
              |
        _cons |     28.850      8.599     3.36   0.001       11.977      45.723
-------------------------------------------------------------------------------

. reg foregone_prof_pct proof d_g_gin-d_g_teq d_s_750-d_s_175L i.month i.total_options if good, vce(robust) cf
> ormat(%9.3f) pformat(%5.3f)

Linear regression                                      Number of obs =    1060
                                                       F( 28,  1031) =12540.56
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.9977
                                                       Root MSE      =  .05032

-------------------------------------------------------------------------------
              |               Robust
foregone_pr~t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
        proof |     -0.000      0.000    -2.98   0.003       -0.001      -0.000
      d_g_gin |      0.006      0.005     1.15   0.250       -0.004       0.017
      d_g_vod |     -0.005      0.004    -1.19   0.234       -0.012       0.003
      d_g_rum |     -0.038      0.011    -3.50   0.000       -0.060      -0.017
      d_g_sch |      0.012      0.006     2.21   0.028        0.001       0.023
      d_g_brb |      0.007      0.004     1.64   0.102       -0.001       0.015
      d_g_whs |     -0.006      0.005    -1.09   0.278       -0.017       0.005
      d_g_teq |      0.006      0.010     0.60   0.551       -0.014       0.026
    d_s_750ML |     -0.025      0.012    -2.03   0.043       -0.050      -0.001
       d_s_1L |     -0.018      0.012    -1.47   0.143       -0.042       0.006
     d_s_175L |     -0.030      0.012    -2.54   0.011       -0.054      -0.007
              |
        month |
           2  |     -0.009      0.009    -1.00   0.320       -0.025       0.008
           3  |     -0.003      0.007    -0.45   0.656       -0.016       0.010
           4  |     -0.001      0.008    -0.11   0.911       -0.016       0.014
           5  |     -0.007      0.008    -0.93   0.350       -0.023       0.008
           6  |     -0.007      0.008    -0.85   0.396       -0.022       0.009
           7  |      0.000      0.008     0.02   0.983       -0.016       0.017
           8  |     -0.009      0.008    -1.09   0.277       -0.024       0.007
           9  |     -0.004      0.007    -0.62   0.537       -0.018       0.009
          10  |     -0.009      0.008    -1.14   0.255       -0.025       0.007
          11  |     -0.012      0.008    -1.44   0.151       -0.028       0.004
          12  |     -0.002      0.007    -0.35   0.723       -0.015       0.011
              |
total_options |
           3  |     -3.370      0.019  -180.80   0.000       -3.406      -3.333
           4  |     -4.188      0.018  -231.76   0.000       -4.223      -4.153
           5  |     -4.466      0.017  -256.20   0.000       -4.500      -4.431
           6  |     -4.566      0.018  -248.10   0.000       -4.602      -4.530
           7  |     -4.609      0.020  -228.32   0.000       -4.648      -4.569
           8  |     -4.640      0.019  -245.33   0.000       -4.677      -4.602
              |
        _cons |      4.771      0.023   204.04   0.000        4.725       4.817
-------------------------------------------------------------------------------

. 
. 
. // renaming unnamed variables
. egen r_t_prof_top = rowfirst(v*)
(8567 missing values generated)

. 
. // Calculating heterogeneity effect graph for retailers
. preserve

.         keep if product == 64 & purchase_year == 2011 & purchase_month == 5 // Bacardi Rum
(9727 observations deleted)

.         reshape long t_cut_ r_t_prof_, i(product purchase_month purchase_year) j(option) string
(note: j = 1 2 3 4 5 6 7 8 top)
(note: t_cut_top not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->       9
Number of variables                 215   ->     201
j variable (9 values)                     ->   option
xij variables:
          t_cut_1 t_cut_2 ... t_cut_top   ->   t_cut_
 r_t_prof_1 r_t_prof_2 ... r_t_prof_top   ->   r_t_prof_
-----------------------------------------------------------------------------

.         replace t_cut_ = 1.0 if option == "top"
(1 real change made)

.         twoway (connected r_t_prof_ t_cut) if option != "top", ///
>                 title("Bacardi Superior 750ML, May 2011") ///
>                 ytitle("Change in Type {&lambda} Retailer Profit") ///
>                 xtitle("Type {&lambda}") ///
>                 note("Approximately 38% of the distribution in first segment and 34% in second segment")

.         graph export r_change_by_type.pdf, replace
(file r_change_by_type.pdf written in PDF format)

.         
.         drop if t_cut_ == .
(5 observations deleted)

.         
.         set obs 1000 // set total number of interpolation points here
obs was 4, now 1000

.         gen order = _n-1

.         
.         // second cut
.         gen tag = (order == (_N-1)/3)

.         replace order = (_N-1)/3 if order == 1
(1 real change made)

.         replace order = 1 if tag == 1
(1 real change made)

.         drop tag

.         
.         //third cut
.         gen tag = (order == 2*(_N-1)/3)

.         replace order = 2*(_N-1)/3 if order == 2
(1 real change made)

.         replace order = 2 if tag == 1
(1 real change made)

.         drop tag

.         
.         //last cut
.         gen tag = (order == 3*(_N-1)/3)

.         replace order = 3*(_N-1)/3 if order == 3
(1 real change made)

.         replace order = 3 if tag == 1
(1 real change made)

.         drop tag

.         
.         ipolate t_cut_ order, gen(ip_t_cut)

.         ipolate r_t_prof_ ip_t_cut, gen(ip_r_t_prof)

.         
.         sort order

.         
.         gen scaled = ip_r_t_prof*betaden(1,18.66937,ip_t_cut )

.         
.         twoway (connected scaled ip_t_cut, msize(0)), title("") ///
>                 ytitle("Change in Type {&lambda} Retailer Profit") ///
>                 xtitle("Type {&lambda}") ///
>                 note("Bacardi Superior 750ML, May 2011. Scaled by estimated density. c=7.02, b=18.67") yline
> (0, lcolor(black)) ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

.         graph export r_change_by_type_smooth.pdf, replace
(file r_change_by_type_smooth.pdf written in PDF format)

.         
.         
. restore

. 
. sum price proof imported d_s_* if good

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       price |      1060    21.27352    8.988968        .49      60.99
       proof |      1060     76.9983    12.21398         25        100
    imported |      1060         .35    .4771947          0          1
   d_s_375ML |      1060    .0113208     .105845          0          1
   d_s_750ML |      1060    .0830189     .276041          0          1
-------------+--------------------------------------------------------
      d_s_1L |      1060    .2386792    .4264775          0          1
    d_s_175L |      1060    .6669811    .4715157          0          1

. 
. reg c_mode d_g_gin-d_g_teq d_s_375ML d_s_750ML d_s_175L proof if good, robust

Linear regression                                      Number of obs =    1060
                                                       F( 11,  1048) =   41.99
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.1498
                                                       Root MSE      =  8.4523

------------------------------------------------------------------------------
             |               Robust
      c_mode |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     d_g_gin |  -1.929195   1.585403    -1.22   0.224    -5.040121    1.181732
     d_g_vod |   -5.94322   1.336764    -4.45   0.000    -8.566258   -3.320182
     d_g_rum |  -2.711149   1.273348    -2.13   0.033    -5.209751   -.2125469
     d_g_sch |   5.418455   1.495809     3.62   0.000     2.483334    8.353576
     d_g_brb |  -3.957867   1.398002    -2.83   0.005    -6.701069   -1.214665
     d_g_whs |  -5.770637   1.394682    -4.14   0.000    -8.507324    -3.03395
     d_g_teq |   -3.05179   1.971032    -1.55   0.122    -6.919409    .8158276
   d_s_375ML |  -9.687872   .8593397   -11.27   0.000    -11.37409    -8.00165
   d_s_750ML |  -1.294933   .9973293    -1.30   0.194    -3.251922     .662057
    d_s_175L |   1.739375   .7008203     2.48   0.013     .3642038    3.114545
       proof |   .0835154   .0368552     2.27   0.024     .0111969    .1558338
       _cons |   9.878443   2.117751     4.66   0.000     5.722928    14.03396
------------------------------------------------------------------------------

. 
. forvalues i = 0/7 {
  2.         gen margin`i' = (actual_p`i' / bottles_per_case) / c_mode - 1
  3.         cumul margin`i', gen(cum`i')
  4. }
(8580 missing values generated)
(8580 missing values generated)
(8666 missing values generated)
(8867 missing values generated)
(9127 missing values generated)
(9466 missing values generated)
(9655 missing values generated)
(9717 missing values generated)

. 
. egen min_p = rowmin(actual_p*)
(8567 missing values generated)

. gen min_margin = min_p / bottles_per_case / c_mode - 1
(8580 missing values generated)

. 
. tabstat margin* min_margin if good, stat(mean min p50 max) col(stat)

    variable |      mean       min       p50       max
-------------+----------------------------------------
     margin0 |  .7988362  .1436883   .557049  9.119897
     margin1 |  .6625085  .0000569   .436825  9.070339
     margin2 |  .5571192  .0000384  .3632621  8.988119
     margin3 |  .4351303  1.67e-06  .2984478  5.582727
     margin4 |  .3826504  2.93e-06  .2350963  5.363303
     margin5 |  .2974029  2.20e-06  .1859365  1.521119
     margin6 |  .1415375  4.36e-06  .1584769  .6241903
     margin7 |  .0767881  .0006767    .07383  .1270954
  min_margin |  .4479873  1.67e-06  .2298598  8.988119
------------------------------------------------------

.         
. twoway (function y=betaden(1,1,x),      lwidth(medthick)) ///
>         (function y=betaden(1,6,x),     lwidth(medthick)) ///
>         (function y=betaden(1,.5,x),    lwidth(medthick)), ///
>         title("") ytitle("") xtitle("") ///
>         legend(label(1 "Beta(1,1)") label(2 "Beta(1,6)") label(3 "Beta(1,0.5)") ///
>         ring(0) bplacement(2) bmargin(large) col(1)) ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. graph export density_comp.pdf, replace
(file density_comp.pdf written in PDF format)

. 
. local a = -0.4

. local b = 1

. 
. twoway (function y=exp(`a'*x)/(`b' + exp(`a'*x))*1, range(0 10) lwidth(medthick)) ///
>         (function y=exp(`a'*x)/(`b' + exp(`a'*x))*.75, range(0 10) lwidth(medthick)) ///
>         (function y=exp(`a'*x)/(`b' + exp(`a'*x))*.5, range(0 10) lwidth(medthick)), ///
>         title("") ytitle("Market Share") xtitle("Price") ///
>         legend(label(1 "1.00s(p)") label(2 "0.75s(p)") label(3 "0.50s(p)") ///
>         ring(0) bplacement(2) bmargin(large) col(1) off) ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0))
(note:  named style 0 not found in class margin, default attributes used)

. 
. /*
> twoway (function y=-ln(1/x - `b')/`a', range(0 .5) lwidth(medthick)) ///
>         (function y=-ln(1/x - `b')/`a'*.75, range(0 .5) lwidth(medthick)) ///
>         (function y=-ln(1/x - `b')/`a'*.5, range(0 .5) lwidth(medthick)), ///
>         title("") ytitle("Price") xtitle("Market Share") ///
>         legend(label(1 "1.00s(p)") label(2 "0.75s(p)") label(3 "0.50s(p)") ///
>         ring(0) bplacement(2) bmargin(large) col(1) off) ///
>         graphregion(color(white)) ylabel(,nogrid) plotregion(margin(0)) 
> */
.         
. graph export single_crossing.pdf, replace
(file single_crossing.pdf written in PDF format)

. 
. 
. 
. log close
      name:  <unnamed>
       log:  E:\Box\Box Sync\Snuffles Backup\gh8728\Projects\Liquor\supply_side\module\cf_analysis.txt
  log type:  text
 closed on:  16 Mar 2018, 11:39:05
--------------------------------------------------------------------------------------------------------------
