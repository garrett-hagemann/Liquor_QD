----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\Box\Box Sync\Snuffles Backup\gh8728\Projects\Liquor\Data\Nielsen_Panel\analysis\asclogit_test.txt
  log type:  text
 opened on:   9 May 2017, 16:28:01

. 
. use individual_logit_sample.dta

. 
. // generating dummies for income levels
. gen byte inc_lt30 = (household_income <= 15)

. gen byte inc_30_to_70 = (household_income > 15 & household_income <= 23)

. gen byte inc_70_to_100 = (household_income == 26)

. gen byte inc_100_plus = (household_income > 26)

. 
. gen p_x_inc_lt30 = price*inc_lt30

. gen p_x_inc_30_to_70 = price*inc_30_to_70

. gen p_x_inc_70_to_100 = price*inc_70_to_100

. gen p_x_inc_100_plus = price*inc_100_plus

. 
. gen neg_p_x_inc_lt30 = -p_x_inc_lt30 - 1e-2

. gen neg_p_x_inc_30_to_70 = -p_x_inc_30_to_70 - 1e-2

. gen neg_p_x_inc_70_to_100= -p_x_inc_70_to_100 - 1e-2

. gen neg_p_x_inc_100_plus = -p_x_inc_100_plus - 1e-2

. 
. gen byte month = month(dofm(date_m))

. 
. gen byte d_m_1 = (month == 1)

. gen byte d_m_2 = (month == 2)

. gen byte d_m_3 = (month == 3)

. gen byte d_m_4 = (month == 4)

. gen byte d_m_5 = (month == 5)

. gen byte d_m_6 = (month == 6)

. gen byte d_m_7 = (month == 7)

. gen byte d_m_8 = (month == 8)

. gen byte d_m_9 = (month == 9)

. gen byte d_m_10 = (month == 10)

. gen byte d_m_11 = (month == 11)

. gen byte d_m_12 = (month == 12)

. 
. // generating income  x liquor group interactions
. foreach inc of varlist inc_* {
  2.         foreach group of varlist d_g_*{
  3.                 gen byte `inc'_x_`group' = `inc'*`group'
  4.         }
  5. }

. 
. 
. // generating proof x income group
. gen proof_x_inc_lt30 = proof*inc_lt30

. gen proof_x_inc_30_to_70 = proof*inc_30_to_70

. gen proof_x_inc_70_to_100 = proof*inc_70_to_100

. gen proof_x_inc_100_plus = proof*inc_100_plus

. 
. // generating imported x income group
. gen byte imported_x_inc_lt30 = imported*inc_lt30

. gen byte imported_x_inc_30_to_70 = imported*inc_30_to_70

. gen byte imported_x_inc_70_to_100 = imported*inc_70_to_100

. gen byte imported_x_inc_100_plus = imported*inc_100_plus

. 
. //// sampling cases
> /*
> gen sort_order = _n
> egen select = tag(case)
> gen rand = runiform()
> sort select rand
> replace select = (_n > (_N-3000)) // 1k cases
> bys case (select): replace select = select[_N]
> sort sort_order
> drop sort_order rand
> keep if select == 1
> */
. /////
> 
. //generating product dummies
. foreach i of numlist 1/101{
  2.         gen d_p_`i' = (product == `i')
  3. }

. 
. 
. //asclogit choice p_x_* imported_x_* proof_x_* d_g_gin d_g_vod d_g_rum d_g_sch, case(case) alt(product) base(0) diff
. mixlogit choice imported_x_* proof_x_* d_g_gin d_g_vod d_g_rum d_g_sch d_p_1-d_p_101, group(case) rand(p_x_*) iter(150)

Iteration 0:   log likelihood = -28223.972  (not concave)
Iteration 1:   log likelihood = -27419.292  
Iteration 2:   log likelihood = -27294.606  
Iteration 3:   log likelihood = -27289.475  (not concave)
Iteration 4:   log likelihood = -27289.453  
Iteration 5:   log likelihood = -27289.244  
Iteration 6:   log likelihood = -27289.242  

Mixed logit model                                 Number of obs   =     955075
                                                  LR chi2(4)      =      48.83
Log likelihood = -27289.242                       Prob > chi2     =     0.0000

------------------------------------------------------------------------------------------
                  choice |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------------------+----------------------------------------------------------------
Mean                     |
     imported_x_inc_lt30 |  -.1549591   .1106341    -1.40   0.161    -.3717979    .0618796
 imported_x_inc_30_to_70 |  -.3626817    .092779    -3.91   0.000    -.5445251   -.1808383
imported_x_inc_70_to_100 |  -.2814536   .1015758    -2.77   0.006    -.4805385   -.0823687
 imported_x_inc_100_plus |  -.2519711   .1094559    -2.30   0.021    -.4665007   -.0374415
        proof_x_inc_lt30 |   .0300896   .0019343    15.56   0.000     .0262983    .0338808
    proof_x_inc_30_to_70 |   .0154656    .001321    11.71   0.000     .0128765    .0180547
   proof_x_inc_70_to_100 |   .0191501   .0017106    11.19   0.000     .0157973    .0225028
    proof_x_inc_100_plus |  -.0019593   .0017791    -1.10   0.271    -.0054462    .0015277
                 d_g_gin |  -.9980637   .1116205    -8.94   0.000    -1.216836   -.7792914
                 d_g_vod |   .8108195   .0901297     9.00   0.000     .6341686    .9874705
                 d_g_rum |  -.2365993   .0758647    -3.12   0.002    -.3852914   -.0879071
                 d_g_sch |  -.7477314   .1126442    -6.64   0.000      -.96851   -.5269528
                   d_p_1 |  -3.121894   .1363533   -22.90   0.000    -3.389142   -2.854647
                   d_p_2 |  -3.121704   .1414907   -22.06   0.000     -3.39902   -2.844387
                   d_p_3 |  -4.801027   .1442459   -33.28   0.000    -5.083744    -4.51831
                   d_p_4 |  -5.014518   .1503875   -33.34   0.000    -5.309273   -4.719764
                   d_p_5 |  -4.846033   .1567335   -30.92   0.000    -5.153226   -4.538841
                   d_p_6 |  -3.435482   .1643219   -20.91   0.000    -3.757547   -3.113417
                   d_p_7 |  -4.777261   .1581462   -30.21   0.000    -5.087222     -4.4673
                   d_p_8 |  -2.949315   .1439527   -20.49   0.000    -3.231457   -2.667173
                   d_p_9 |  -4.601557   .1430839   -32.16   0.000    -4.881997   -4.321118
                  d_p_10 |  -4.360644   .1398229   -31.19   0.000    -4.634692   -4.086597
                  d_p_11 |    -5.3786   .1627506   -33.05   0.000    -5.697585   -5.059614
                  d_p_12 |  -5.390806   .1637476   -32.92   0.000    -5.711745   -5.069866
                  d_p_13 |  -3.930106   .1711135   -22.97   0.000    -4.265483    -3.59473
                  d_p_14 |  -4.342176   .1587823   -27.35   0.000    -4.653383   -4.030968
                  d_p_15 |  -4.342773   .1724256   -25.19   0.000    -4.680721   -4.004825
                  d_p_16 |  -4.797522   .1586484   -30.24   0.000    -5.108467   -4.486577
                  d_p_17 |  -5.466756   .1762301   -31.02   0.000    -5.812161   -5.121352
                  d_p_18 |  -4.916693   .1652725   -29.75   0.000    -5.240621   -4.592765
                  d_p_19 |  -3.724147   .1676683   -22.21   0.000    -4.052771   -3.395524
                  d_p_20 |  -5.618995   .1787486   -31.44   0.000    -5.969335   -5.268654
                  d_p_21 |     -4.223    .159203   -26.53   0.000    -4.535033   -3.910968
                  d_p_22 |  -3.830568   .1752867   -21.85   0.000    -4.174124   -3.487012
                  d_p_23 |  -4.448236   .1820384   -24.44   0.000    -4.805025   -4.091447
                  d_p_24 |  -4.904963   .1764104   -27.80   0.000    -5.250721   -4.559205
                  d_p_25 |  -6.201783   .1951512   -31.78   0.000    -6.584273   -5.819294
                  d_p_26 |  -3.911629   .1855277   -21.08   0.000    -4.275256   -3.548001
                  d_p_27 |  -4.470888   .1789333   -24.99   0.000     -4.82159   -4.120185
                  d_p_28 |  -6.215972    .190859   -32.57   0.000    -6.590049   -5.841895
                  d_p_29 |  -5.339201   .1835664   -29.09   0.000    -5.698985   -4.979417
                  d_p_30 |  -4.433005   .1990145   -22.27   0.000    -4.823066   -4.042943
                  d_p_31 |   -5.04312   .1847197   -27.30   0.000    -5.405164   -4.681076
                  d_p_32 |  -5.455826   .1948621   -28.00   0.000    -5.837749   -5.073903
                  d_p_33 |  -4.350398   .1820515   -23.90   0.000    -4.707213   -3.993584
                  d_p_34 |  -4.999972   .2101443   -23.79   0.000    -5.411847   -4.588097
                  d_p_35 |   -5.11608   .2023433   -25.28   0.000    -5.512666   -4.719495
                  d_p_36 |  -5.068243   .2004136   -25.29   0.000    -5.461047    -4.67544
                  d_p_37 |  -5.927884   .2051706   -28.89   0.000    -6.330011   -5.525757
                  d_p_38 |  -5.143831   .2027391   -25.37   0.000    -5.541192    -4.74647
                  d_p_39 |  -4.432692   .2090742   -21.20   0.000     -4.84247   -4.022915
                  d_p_40 |  -5.631095   .2038515   -27.62   0.000    -6.030636   -5.231553
                  d_p_41 |  -4.801862   .2059438   -23.32   0.000    -5.205505    -4.39822
                  d_p_42 |  -5.574736   .2067301   -26.97   0.000     -5.97992   -5.169553
                  d_p_43 |  -5.192336   .2212017   -23.47   0.000    -5.625883   -4.758789
                  d_p_44 |  -4.960927   .2061618   -24.06   0.000    -5.364997   -4.556857
                  d_p_45 |  -4.160068    .223443   -18.62   0.000    -4.598009   -3.722128
                  d_p_46 |  -3.903724   .2213035   -17.64   0.000    -4.337471   -3.469977
                  d_p_47 |  -5.181415   .2161589   -23.97   0.000    -5.605079   -4.757752
                  d_p_48 |  -3.886327   .2215541   -17.54   0.000    -4.320565   -3.452089
                  d_p_49 |  -5.344421     .22932   -23.31   0.000     -5.79388   -4.894962
                  d_p_50 |  -5.285977   .2152643   -24.56   0.000    -5.707887   -4.864067
                  d_p_51 |    -4.1023   .2353802   -17.43   0.000    -4.563637   -3.640964
                  d_p_52 |  -5.637782   .2209452   -25.52   0.000    -6.070826   -5.204737
                  d_p_53 |  -4.822594    .208502   -23.13   0.000     -5.23125   -4.413938
                  d_p_54 |  -3.958131   .2316138   -17.09   0.000    -4.412086   -3.504176
                  d_p_55 |  -6.565579   .2326859   -28.22   0.000    -7.021635   -6.109523
                  d_p_56 |  -4.548577   .2423878   -18.77   0.000    -5.023649   -4.073506
                  d_p_57 |  -5.601947    .229601   -24.40   0.000    -6.051956   -5.151937
                  d_p_58 |  -3.987991   .2335567   -17.08   0.000    -4.445754   -3.530228
                  d_p_59 |  -4.912977   .2481604   -19.80   0.000    -5.399363   -4.426592
                  d_p_60 |  -4.840165   .2240225   -21.61   0.000    -5.279241   -4.401089
                  d_p_61 |  -6.880695   .2427853   -28.34   0.000    -7.356546   -6.404845
                  d_p_62 |  -5.605676   .2354983   -23.80   0.000    -6.067245   -5.144108
                  d_p_63 |  -5.188475   .2311536   -22.45   0.000    -5.641528   -4.735422
                  d_p_64 |  -5.377887   .2438225   -22.06   0.000     -5.85577   -4.900003
                  d_p_65 |   -4.09764   .2392335   -17.13   0.000    -4.566529   -3.628751
                  d_p_66 |  -5.108016   .2317603   -22.04   0.000    -5.562258   -4.653774
                  d_p_67 |  -5.710825   .2461031   -23.21   0.000    -6.193179   -5.228472
                  d_p_68 |  -5.113058   .2296291   -22.27   0.000    -5.563123   -4.662993
                  d_p_69 |  -5.991073   .2441346   -24.54   0.000    -6.469568   -5.512577
                  d_p_70 |  -5.567423   .2339337   -23.80   0.000    -6.025924   -5.108921
                  d_p_71 |  -6.625885   .2529189   -26.20   0.000    -7.121597   -6.130173
                  d_p_72 |  -5.299186   .2278957   -23.25   0.000    -5.745853   -4.852518
                  d_p_73 |  -6.272768   .2528628   -24.81   0.000     -6.76837   -5.777166
                  d_p_74 |  -5.579566   .2498553   -22.33   0.000    -6.069273   -5.089858
                  d_p_75 |  -5.928923   .2488489   -23.83   0.000    -6.416658   -5.441188
                  d_p_76 |  -4.585755   .2598233   -17.65   0.000    -5.094999    -4.07651
                  d_p_77 |  -5.869962   .2464035   -23.82   0.000    -6.352904    -5.38702
                  d_p_78 |  -5.508581    .246029   -22.39   0.000    -5.990789   -5.026373
                  d_p_79 |  -4.829222   .2431559   -19.86   0.000    -5.305799   -4.352645
                  d_p_80 |   -6.51405   .2576998   -25.28   0.000    -7.019133   -6.008968
                  d_p_81 |   -5.81735   .2521696   -23.07   0.000    -6.311593   -5.323107
                  d_p_82 |  -6.198225    .263303   -23.54   0.000    -6.714289    -5.68216
                  d_p_83 |   -6.39506    .263534   -24.27   0.000    -6.911577   -5.878543
                  d_p_84 |  -5.299936   .2515099   -21.07   0.000    -5.792886   -4.806985
                  d_p_85 |  -7.157789   .2723607   -26.28   0.000    -7.691607   -6.623972
                  d_p_86 |  -5.640015   .2618599   -21.54   0.000    -6.153251   -5.126779
                  d_p_87 |   -5.26857   .2728423   -19.31   0.000    -5.803331   -4.733809
                  d_p_88 |  -4.868245   .2718934   -17.90   0.000    -5.401147   -4.335344
                  d_p_89 |  -4.543375   .2719137   -16.71   0.000    -5.076316   -4.010434
                  d_p_90 |  -4.700213   .2788118   -16.86   0.000    -5.246674   -4.153752
                  d_p_91 |  -4.514191   .2592387   -17.41   0.000    -5.022289   -4.006092
                  d_p_92 |  -5.530586   .2767002   -19.99   0.000    -6.072909   -4.988264
                  d_p_93 |  -4.470521   .2551977   -17.52   0.000    -4.970699   -3.970343
                  d_p_94 |  -4.471254   .2555095   -17.50   0.000    -4.972044   -3.970465
                  d_p_95 |  -5.435326     .26222   -20.73   0.000    -5.949268   -4.921385
                  d_p_96 |  -4.380613   .2690367   -16.28   0.000    -4.907915    -3.85331
                  d_p_97 |  -6.817262   .2761831   -24.68   0.000    -7.358571   -6.275953
                  d_p_98 |    -6.6457   .2837059   -23.42   0.000    -7.201754   -6.089647
                  d_p_99 |   -6.61709   .2836054   -23.33   0.000    -7.172947   -6.061234
                 d_p_100 |  -6.495391   .3037395   -21.38   0.000     -7.09071   -5.900073
                 d_p_101 |  -.1659607   .0690171    -2.40   0.016    -.3012318   -.0306896
            p_x_inc_lt30 |  -.1288769   .0084154   -15.31   0.000    -.1453708    -.112383
        p_x_inc_30_to_70 |  -.0373797   .0029994   -12.46   0.000    -.0432584    -.031501
       p_x_inc_70_to_100 |  -.0312302   .0048198    -6.48   0.000    -.0406768   -.0217837
        p_x_inc_100_plus |    .028152   .0041762     6.74   0.000     .0199668    .0363372
-------------------------+----------------------------------------------------------------
SD                       |
            p_x_inc_lt30 |   .0671053   .0073541     9.12   0.000     .0526916     .081519
        p_x_inc_30_to_70 |   .0006841   .0061962     0.11   0.912    -.0114602    .0128284
       p_x_inc_70_to_100 |   .0248932    .009925     2.51   0.012     .0054406    .0443458
        p_x_inc_100_plus |   -.008243   .0176767    -0.47   0.641    -.0428886    .0264027
------------------------------------------------------------------------------------------
The sign of the estimated standard deviations is irrelevant: interpret them as
being positive

. 
. export delimited asclogit_test.csv, replace
file asclogit_test.csv saved

. /*
> /* Adjusting constants to account for choice based sample */
> 
> predict xb, xb
> 
> gen adj_util = xb - ln(sample_weight/pop_weight)
> 
> gen num = exp(adj_util)
> egen denom = total(exp(adj_util)), by(case)
> gen prob = num/denom
> 
> local alpha1 = _b[p_x_inc_lt30]
> local alpha2 =  _b[p_x_inc_30_to_70]
> local alpha3 = _b[p_x_inc_70_to_100]
> local alpha4 = _b[p_x_inc_100_plus]
> 
> gen ed_ij = (`alpha1'*inc_lt30 + `alpha2'*inc_30_to_70 + `alpha3'*inc_70_to_100 + `alpha4'*inc_100_plus)*price*(1-prob)
> 
> egen ed_j = mean(ed_ij), by(product)
> 
> sum ed_j, det
> 

end of do-file

. log close
      name:  <unnamed>
       log:  D:\Box\Box Sync\Snuffles Backup\gh8728\Projects\Liquor\Data\Nielsen_Panel\analysis\asclogit_test.txt
  log type:  text
 closed on:  10 May 2017, 17:09:46
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
